---
id: usage
title: xform
---

import * as basicExamples from 'story/src/xform/1-basic-examples.stories';

[![NPM Package](https://img.shields.io/npm/v/@rexd/xform.svg?style=flat-square)](https://www.npmjs.org/package/@rexd/xform)

`@rexd/xform`： 一个基于 mobx 的表单方案。

:::danger alpha
@rexd/xform 仍在准备阶段，目前尚不可用，敬请期待.

目前文档反映的是 @alife/hippo-xform（正在积极开发中的内部版本）的最新版。
:::

## 特点

- 上手简单，搭配 mobx 可以进行快速开发
- 精确渲染，轻松应对大表单场景
- **重度依赖 [mobx](https://mobx.js.org/)，继承 mobx 的优缺点**
  - 表单内核采用 mobx 提供的数据结构，无缝对接 mobx 生态
- 概念较少，学习成本较低

### 数据索引名称限制

- 字段名称不能包含 `.`
- 字段名称不能为 `&`

## 开始使用

在使用表单之前，我们需要先创建一个 FormModel 对象，然后通过 props.model 传递给 Form：

```jsx
import { Form, FormItem, FormModel } from '@rexd/xform';

// step1 创建表单模型
const model = new FormModel({
  name: '小河马',
  phone: '188-8888-8888',
  address: '杭州市余杭区文一西路969号',
});

// step2 使用
export function Basic() {
  return (
    <Form model={model}>
      <FormItem component="input" label="姓名" name="name" required />
      <FormItem component="input" label="电话" name="phone" required />
      <FormItem component="input" label="地址" name="address" />
    </Form>
  );
}
```

<details>

<summary>如果你使用 mobx 管理应用状态，那么可以在 store 中创建 FormModel 对象：</summary>

```jsx
import { observable, computed, makeObservable } from 'mobx';
import { FormModel } from '@rexd/xform';

class Store {
  @observable
  formModel = new FormModel({
    name: '小河马',
    phone: '188-8888-8888',
    address: '杭州市余杭区文一西路969号',
  });

  @computed
  get formValues() {
    return formModel.values;
  }

  constructor() {
    makeObservable(this);
  }
}
```

</details>

## 示例

### 基本示例

<Story fn={basicExamples.Basic} />

### 非受控用法

xform 支持非受控用法，此时我们用 `defaultValue` 来设置表单的初始值，并配合 `<Form.Submit />` 和 `onSubmit()` 回调来实现表单逻辑。

<Story fn={basicExamples.BasicUncontrolled} />

### 嵌套数据索引

xform 支持使用 `name="foo.bar.buzz"` 的形式来使用嵌套的数据索引。注意数据索引的名称有一定的限制。

<Story fn={basicExamples.NestedField} />

### 字段校验

支持使用 `validate={ value => error }` 进行简单的校验。

<Story fn={basicExamples.Validation} />

### 联动

使用 `<Form.Effect watch={watch} effect={effect} />` 后，每当 `watch` 对应的值发生变化时，effect 都会被调用，你可以由此来创建简单的联动。

除了字符串（表示数据索引）之外，watch 也支持接受 [`Field`](api#field)， [`AsyncValue`](api#asyncvalue)，或是这些对象组成的一个数组。具体用法详见 [`Form.Effect` api](api#formeffect).

<Story fn={basicExamples.BasicEffect} />

### 自定义布局

FormItem 与普通元素（div，p，span）一起使用，实现自定义的表单内布局。

<Story fn={basicExamples.InnerLayout} />

### 对表单进行操作

modelUtils 提供了一些针对 model 的工具方法，例如 批量校验 `validateAll`，清除错误 `clearError`，重置 `reset`，提交 `submit` 等。

<Story fn={basicExamples.WithActions} />

## API

详见 [xform API](api).
