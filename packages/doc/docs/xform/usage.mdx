---
id: usage
title: xform
---

import * as basicExamples from 'story/src/xform/1-basic-examples.stories';

[![NPM Package](https://img.shields.io/npm/v/@rexd/xform.svg?style=flat-square)](https://www.npmjs.org/package/@rexd/xform)

`@rexd/xform`： 一个基于 mobx 的表单方案。

:::danger alpha
@rexd/xform 仍在准备阶段，目前尚不可用，敬请期待.

目前文档反映的是 @alife/hippo-xform（正在积极开发中的内部版本）的最新版。
:::

## 特点

- **重度依赖 [mobx](https://mobx.js.org/)，继承 mobx 的优缺点**
  - 表单内核采用 mobx 提供的数据结构，无缝对接 mobx 生态
- 概念精简，上手轻松
  - 当然你需要对 mobx 有所一定程度的了解
- 精确渲染，高性能，大表单场景下交互流畅

### 数据索引名称限制

- 不能包含 `.`
- 不能为 `&`

## 开始使用

在使用表单之前，你需要先创建一个 FormModel 对象，然后通过 props.model 传递给 Form：

```jsx
import { Form, FormItem, FormModel } from '@rexd/xform';

// step1 创建表单模型
const model = new FormModel({
  name: '小河马',
  phone: '188-8888-8888',
  address: '杭州市余杭区文一西路969号',
});

// step2 使用
export function Basic() {
  return (
    <Form model={model}>
      <FormItem component="input" label="姓名" name="name" required />
      <FormItem component="input" label="电话" name="phone" required />
      <FormItem component="input" label="地址" name="address" />
    </Form>
  );
}
```

### 创建 FormModel 的时机

:::danger
初始化 FormModel 的过程需要放在 render 函数之外，保证前后两次渲染使用同一个 FormModel 对象。
:::

#### 创建与组件生命周期一致的 FormModel

(todo)

```jsx
import { useState } from 'react';
import { makeObservable, observable } from 'mobx';
import { observer } from 'mobx-react-lite';
import { Form, FormItem, FormModel } from '@rexd/xform';

class MyComponentStore {
  model = new FormModel({ name: '小河马', phone: '188-8888-8888' });

  // 这里可以定义其他状态
  someOtherState = {};

  constructor() {
    makeObservable(this, {
      model: observable,
      someOtherState: observable,
    });
  }
}

export const MyComponent = observer(() => {
  const [store] = useState(() => new MyComponentStore());

  return (
    <Form model={store.model}>
      <FormItem component="input" label="姓名" name="name" required />
      <FormItem component="input" label="电话" name="phone" required />
      <FormItem component="input" label="地址" name="address" />
    </Form>
  );
});
```

#### 创建全局 FormModel

如果你使用 mobx 管理应用的全局状态，那么可以在 Store 中创建 FormModel 对象：

```jsx
import { observable, makeObservable } from 'mobx';
import { FormModel } from '@rexd/xform';

class Store {
  @observable
  formModel = new FormModel({ name: '小河马', phone: '188-8888-8888' });

  constructor() {
    makeObservable(this);
  }
}
```

## 示例

### 基本示例

<Story fn={basicExamples.Basic} />

### 非受控用法

xform 支持非受控用法，此时我们用 `defaultValue` 来设置表单的初始值，并配合 `<Form.Submit />` 和 `onSubmit()` 回调来实现表单逻辑。

<Story fn={basicExamples.BasicUncontrolled} />

### 嵌套数据索引

xform 支持使用 `name="foo.bar.buzz"` 的形式来使用嵌套的数据索引。注意数据索引的名称有一定的限制。

<Story fn={basicExamples.NestedDataIndex} />

### 字段校验

支持使用 `validate={ value => error }` 进行简单的校验。

<Story fn={basicExamples.Validation} />

### 联动

使用 `<Form.Effect watch={watch} effect={effect} />` 后，每当 `watch` 对应的值发生变化时，effect 都会被调用。

<Story fn={basicExamples.BasicEffect} />

### 自定义布局

FormItem 与普通元素（div，p，span）一起使用，实现自定义的表单内布局。

<Story fn={basicExamples.LayoutWithCustomDiv} />

### 对表单进行操作

modelUtils 提供了一些针对 model 的工具方法，例如 批量校验 `validateAll`，清除错误 `clearError`，重置 `reset`，提交 `submit` 等。

<Story fn={basicExamples.WithActions} />

## API

详见 [xform API](api).
