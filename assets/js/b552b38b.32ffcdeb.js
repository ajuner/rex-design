(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{142:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return _})),t.d(n,"metadata",(function(){return E})),t.d(n,"toc",(function(){return x})),t.d(n,"default",(function(){return C}));var r=t(3),a=t(7),o=t(0),l=t.n(o),i=t(161),u=t(204),s=t(179),c=t(309);function d(){var e=Object(u.f)({defaultColumnWidth:180,operationColumn:{lock:!0},orderColumn:{width:50,lock:!0}});return l.a.createElement(u.a,{defaultValue:{array:[{},{}]}},l.a.createElement(u.a.Array,{name:"array",layout:e},l.a.createElement(u.c,{component:"input",name:"aa",label:"\u5b57\u6bb51",required:!0}),l.a.createElement(u.c,{component:"input",name:"bb",label:"\u5b57\u6bb52"}),l.a.createElement(u.c,{component:"input",name:"cc",label:"\u5b57\u6bb53"}),l.a.createElement(u.c,{component:"dateRangePicker",name:"dd",label:"\u5b57\u6bb54",required:!0,"x-table-column":{width:240}})),l.a.createElement(u.a.ModelConsumer,null,(function(e){return e.getValue("array",[]).length>3&&l.a.createElement("div",{style:{color:"var(--rex-colors-red-50)",marginTop:4}},"\u8868\u683c\u5185\u7684\u6761\u76ee\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e3")})),l.a.createElement(c.a,null))}var m={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/3-biz-examples.stories.tsx",loc:{start:{line:8,column:7},end:{line:35,column:1}},name:"TableLayout",value:d,source:'function TableLayout() {\n  const layout = arrayTable({\n    defaultColumnWidth: 180,\n    operationColumn: { lock: true },\n    orderColumn: { width: 50, lock: true },\n  });\n\n  return (\n    <Form defaultValue={{ array: [{}, {}] }}>\n      <Form.Array name="array" layout={layout}>\n        <FormItem component="input" name="aa" label="\u5b57\u6bb51" required />\n        <FormItem component="input" name="bb" label="\u5b57\u6bb52" />\n        <FormItem component="input" name="cc" label="\u5b57\u6bb53" />\n        <FormItem component="dateRangePicker" name="dd" label="\u5b57\u6bb54" required x-table-column={{ width: 240 }} />\n      </Form.Array>\n\n      <Form.ModelConsumer>\n        {(mod) =>\n          mod.getValue(\'array\', []).length > 3 && (\n            <div style={{ color: \'var(--rex-colors-red-50)\', marginTop: 4 }}>\u8868\u683c\u5185\u7684\u6761\u76ee\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e3</div>\n          )\n        }\n      </Form.ModelConsumer>\n\n      <ValuePreview />\n    </Form>\n  );\n}',deps:function(){return[]},provides:{arrayTable:u.f,Form:u.a,FormItem:u.c,ValuePreview:c.a}};function p(){return l.a.createElement(u.a,{defaultValue:{array:[{show:!0},{show:!1}]}},l.a.createElement(u.a.Array,{name:"array",layout:Object(u.e)({showItemOrder:!0}),itemFactory:function(e){return{show:e.values.length%2==0}}},l.a.createElement(u.c,{component:"switch",name:"show",label:"\u662f\u5426\u663e\u793a \u8f93\u5165\u6846",defaultValue:!1}),l.a.createElement(u.a.ModelConsumer,null,(function(e){return e.getValue("show")&&l.a.createElement(u.c,{component:"input",name:"input",label:"\u8f93\u5165\u6846",required:!0})}))))}d.__doc_info=m,d.__inner_source='function TableLayout() {\n  const layout = arrayTable({\n    defaultColumnWidth: 180,\n    operationColumn: { lock: true },\n    orderColumn: { width: 50, lock: true },\n  });\n\n  return (\n    <Form defaultValue={{ array: [{}, {}] }}>\n      <Form.Array name="array" layout={layout}>\n        <FormItem component="input" name="aa" label="\u5b57\u6bb51" required />\n        <FormItem component="input" name="bb" label="\u5b57\u6bb52" />\n        <FormItem component="input" name="cc" label="\u5b57\u6bb53" />\n        <FormItem component="dateRangePicker" name="dd" label="\u5b57\u6bb54" required x-table-column={{ width: 240 }} />\n      </Form.Array>\n\n      <Form.ModelConsumer>\n        {(mod) =>\n          mod.getValue(\'array\', []).length > 3 && (\n            <div style={{ color: \'var(--rex-colors-red-50)\', marginTop: 4 }}>\u8868\u683c\u5185\u7684\u6761\u76ee\u6570\u91cf\u4e0d\u80fd\u5927\u4e8e3</div>\n          )\n        }\n      </Form.ModelConsumer>\n\n      <ValuePreview />\n    </Form>\n  );\n}';var f={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/3-biz-examples.stories.tsx",loc:{start:{line:38,column:7},end:{line:55,column:1}},name:"VisibilityControlInArrayItem",value:p,source:'function VisibilityControlInArrayItem() {\n  return (\n    <Form defaultValue={{ array: [{ show: true }, { show: false }] }}>\n      <Form.Array\n        name="array"\n        layout={arrayCard({ showItemOrder: true })}\n        itemFactory={(arrayModel) => {\n          return { show: arrayModel.values.length % 2 === 0 };\n        }}\n      >\n        <FormItem component="switch" name="show" label="\u662f\u5426\u663e\u793a \u8f93\u5165\u6846" defaultValue={false} />\n        <Form.ModelConsumer>\n          {(mod) => mod.getValue(\'show\') && <FormItem component="input" name="input" label="\u8f93\u5165\u6846" required />}\n        </Form.ModelConsumer>\n      </Form.Array>\n    </Form>\n  );\n}',deps:function(){return[]},provides:{Form:u.a,arrayCard:u.e,FormItem:u.c}};function y(){return l.a.createElement(u.a,null,l.a.createElement(u.a.Effect,{watch:"person.effects.aaa",effect:function(e,n){var t=n.model;"123"===e?t.setValue("ddd","this is linkage relationship"):""===e&&t.setValue("ddd","")}}),l.a.createElement("p",null,"\u5185\u90e8\u8ba2\u9605, \u76d1\u542c person.effects.aaa \u503c\u6539\u53d8\uff0c\u5f53\u53d8\u4e3a 123 \u65f6\uff0cddd \u7684\u503c\u88ab\u8bbe\u7f6e\uff1b\u5f53 aaa \u53d8\u4e3a\u7a7a\u65f6\uff0cddd \u4e5f\u88ab\u6e05\u7a7a"),l.a.createElement(u.a.Object,{name:"person.effects"},l.a.createElement(u.c,{component:"input",name:"aaa",label:"person.effects.aaa"}),l.a.createElement(u.c,{component:"input",name:"bbb",label:"person.effects.bbb"})),l.a.createElement(u.c,{component:"input",name:"ccc",label:"ccc"}),l.a.createElement(u.c,{component:"input",name:"ddd",label:"ddd"}),l.a.createElement(c.a,null))}p.__doc_info=f,p.__inner_source='function VisibilityControlInArrayItem() {\n  return (\n    <Form defaultValue={{ array: [{ show: true }, { show: false }] }}>\n      <Form.Array\n        name="array"\n        layout={arrayCard({ showItemOrder: true })}\n        itemFactory={(arrayModel) => {\n          return { show: arrayModel.values.length % 2 === 0 };\n        }}\n      >\n        <FormItem component="switch" name="show" label="\u662f\u5426\u663e\u793a \u8f93\u5165\u6846" defaultValue={false} />\n        <Form.ModelConsumer>\n          {(mod) => mod.getValue(\'show\') && <FormItem component="input" name="input" label="\u8f93\u5165\u6846" required />}\n        </Form.ModelConsumer>\n      </Form.Array>\n    </Form>\n  );\n}';var b={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/3-biz-examples.stories.tsx",loc:{start:{line:58,column:7},end:{line:84,column:1}},name:"DeclarativeEffect",value:y,source:'function DeclarativeEffect() {\n  return (\n    <Form>\n      <Form.Effect\n        watch="person.effects.aaa"\n        effect={(value, { model }) => {\n          if (value === \'123\') {\n            model.setValue(\'ddd\', \'this is linkage relationship\');\n          } else if (value === \'\') {\n            model.setValue(\'ddd\', \'\');\n          }\n        }}\n      />\n\n      <p>\u5185\u90e8\u8ba2\u9605, \u76d1\u542c person.effects.aaa \u503c\u6539\u53d8\uff0c\u5f53\u53d8\u4e3a 123 \u65f6\uff0cddd \u7684\u503c\u88ab\u8bbe\u7f6e\uff1b\u5f53 aaa \u53d8\u4e3a\u7a7a\u65f6\uff0cddd \u4e5f\u88ab\u6e05\u7a7a</p>\n\n      <Form.Object name="person.effects">\n        <FormItem component="input" name="aaa" label="person.effects.aaa" />\n        <FormItem component="input" name="bbb" label="person.effects.bbb" />\n      </Form.Object>\n      <FormItem component="input" name="ccc" label="ccc" />\n      <FormItem component="input" name="ddd" label="ddd" />\n\n      <ValuePreview />\n    </Form>\n  );\n}',deps:function(){return[]},provides:{Form:u.a,FormItem:u.c,ValuePreview:c.a}};y.__doc_info=b,y.__inner_source='function DeclarativeEffect() {\n  return (\n    <Form>\n      <Form.Effect\n        watch="person.effects.aaa"\n        effect={(value, { model }) => {\n          if (value === \'123\') {\n            model.setValue(\'ddd\', \'this is linkage relationship\');\n          } else if (value === \'\') {\n            model.setValue(\'ddd\', \'\');\n          }\n        }}\n      />\n\n      <p>\u5185\u90e8\u8ba2\u9605, \u76d1\u542c person.effects.aaa \u503c\u6539\u53d8\uff0c\u5f53\u53d8\u4e3a 123 \u65f6\uff0cddd \u7684\u503c\u88ab\u8bbe\u7f6e\uff1b\u5f53 aaa \u53d8\u4e3a\u7a7a\u65f6\uff0cddd \u4e5f\u88ab\u6e05\u7a7a</p>\n\n      <Form.Object name="person.effects">\n        <FormItem component="input" name="aaa" label="person.effects.aaa" />\n        <FormItem component="input" name="bbb" label="person.effects.bbb" />\n      </Form.Object>\n      <FormItem component="input" name="ccc" label="ccc" />\n      <FormItem component="input" name="ddd" label="ddd" />\n\n      <ValuePreview />\n    </Form>\n  );\n}';var h=Object(s.a)((function(){var e=Object(u.h)();return l.a.createElement(l.a.Fragment,null,l.a.createElement(u.c,{component:"switch",name:"preview",label:"\u5f00\u542f\u9884\u89c8"}),l.a.createElement(u.b,{isPreview:e.getValue("preview")},l.a.createElement(u.c,{component:"input",name:"username",label:"\u7528\u6237\u540d"}),l.a.createElement(u.c,{component:"numberInput",name:"age",label:"\u5e74\u9f84",defaultValue:18})))})),v={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/3-biz-examples.stories.tsx",loc:{start:{line:86,column:0},end:{line:98,column:3}},name:"SubGroup",value:h,source:'const SubGroup = observer(() => {\n  const model = useModel();\n\n  return (\n    <>\n      <FormItem component="switch" name="preview" label="\u5f00\u542f\u9884\u89c8" />\n      <FormEnvProvider isPreview={model.getValue(\'preview\')}>\n        <FormItem component="input" name="username" label="\u7528\u6237\u540d" />\n        <FormItem component="numberInput" name="age" label="\u5e74\u9f84" defaultValue={18} />\n      </FormEnvProvider>\n    </>\n  );\n});',deps:function(){return[]},provides:{observer:s.a,useModel:u.h,FormItem:u.c,FormEnvProvider:u.b}};function g(){return l.a.createElement(u.a,{style:{fontSize:12},defaultValue:{primary:{},users:[{},{username:"My Name",preview:!0}]}},l.a.createElement(u.a.Object,{name:"primary"},l.a.createElement(h,null)),l.a.createElement(u.a.Array,{name:"users",layout:Object(u.e)({showItemOrder:!0})},l.a.createElement(h,null)),l.a.createElement(c.a,null))}var S={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/3-biz-examples.stories.tsx",loc:{start:{line:100,column:7},end:{line:114,column:1}},name:"LogicsWithinArrayItem",value:g,source:'function LogicsWithinArrayItem() {\n  return (\n    <Form style={{ fontSize: 12 }} defaultValue={{ primary: {}, users: [{}, { username: \'My Name\', preview: true }] }}>\n      <Form.Object name="primary">\n        <SubGroup />\n      </Form.Object>\n\n      <Form.Array name="users" layout={arrayCard({ showItemOrder: true })}>\n        <SubGroup />\n      </Form.Array>\n\n      <ValuePreview />\n    </Form>\n  );\n}',deps:function(){return[v]},provides:{Form:u.a,arrayCard:u.e,ValuePreview:c.a}};g.__inner_source='function LogicsWithinArrayItem() {\n  return (\n    <Form style={{ fontSize: 12 }} defaultValue={{ primary: {}, users: [{}, { username: \'My Name\', preview: true }] }}>\n      <Form.Object name="primary">\n        <SubGroup />\n      </Form.Object>\n\n      <Form.Array name="users" layout={arrayCard({ showItemOrder: true })}>\n        <SubGroup />\n      </Form.Array>\n\n      <ValuePreview />\n    </Form>\n  );\n}',g.__doc_info=S;var O,_={id:"biz",title:"xform \u4e1a\u52a1\u793a\u4f8b"},E={unversionedId:"xform/biz",id:"xform/biz",isDocsHomePage:!1,title:"xform \u4e1a\u52a1\u793a\u4f8b",description:"\u4e1a\u52a1\u8868\u5355\u793a\u4f8b\u3002",source:"@site/docs/xform/biz.mdx",sourceDirName:"xform",slug:"/xform/biz",permalink:"/rex-design/docs/xform/biz",editUrl:"https://github.com/alibaba/rex-design/edit/main/packages/doc/docs/xform/biz.mdx",version:"current",frontMatter:{id:"biz",title:"xform \u4e1a\u52a1\u793a\u4f8b"},sidebar:"docs",previous:{title:"xform \u8fdb\u9636",permalink:"/rex-design/docs/xform/advanced"},next:{title:"xform core",permalink:"/rex-design/docs/xform/core"}},x=[{value:"\u6570\u7ec4\u5143\u7d20\u5185\u90e8\u8054\u52a8",id:"\u6570\u7ec4\u5143\u7d20\u5185\u90e8\u8054\u52a8",children:[]},{value:"\u6570\u7ec4\u5143\u7d20\u5185\u7684\u8054\u52a8 2",id:"\u6570\u7ec4\u5143\u7d20\u5185\u7684\u8054\u52a8-2",children:[]}],F=(O="Story",function(e){return console.warn("Component "+O+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",e)}),V={toc:x};function C(e){var n=e.components,t=Object(a.a)(e,["components"]);return Object(i.b)("wrapper",Object(r.a)({},V,t,{components:n,mdxType:"MDXLayout"}),Object(i.b)("p",null,"\u4e1a\u52a1\u8868\u5355\u793a\u4f8b\u3002"),Object(i.b)("h2",{id:"\u6570\u7ec4\u5143\u7d20\u5185\u90e8\u8054\u52a8"},"\u6570\u7ec4\u5143\u7d20\u5185\u90e8\u8054\u52a8"),Object(i.b)("p",null,"TODO \u793a\u4f8b\u8bf4\u660e"),Object(i.b)(F,{fn:p,mdxType:"Story"}),Object(i.b)("h2",{id:"\u6570\u7ec4\u5143\u7d20\u5185\u7684\u8054\u52a8-2"},"\u6570\u7ec4\u5143\u7d20\u5185\u7684\u8054\u52a8 2"),Object(i.b)("p",null,"TODO \u793a\u4f8b\u8bf4\u660e"),Object(i.b)(F,{fn:g,mdxType:"Story"}))}C.isMDXComponent=!0},204:function(e,n,t){"use strict";t.d(n,"h",(function(){return F})),t.d(n,"b",(function(){return E})),t.d(n,"d",(function(){return T})),t.d(n,"a",(function(){return B})),t.d(n,"c",(function(){return W})),t.d(n,"e",(function(){return H})),t.d(n,"f",(function(){return Q})),t.d(n,"g",(function(){return q}));var r=t(7),a=t(165),o=t(179),l=t(0),i=t.n(l),u=t(215),s=t.n(u);function c(e){e.subModels.forEach((function(e,n){e.name=String(n)}))}function d(e,n,t){if(null!=e){var r=e.splice(n,1)[0];e.splice(t,0,r)}}function m(e,n,t){if(null!=e){var r=e[n];e[n]=e[t],e[t]=r}}function p(e){return String(Number.parseInt(e))===e}function f(e){return p(e)?"array":"object"}function y(e,n,t){for(var r=Array.isArray(n)?n:g(n),o=e,l=0;l<r.length;l+=1){if(!a.isObservable(o))return t;o=a.get(o,r[l])}return void 0===o?t:o}function b(e,n,t){for(var r=Array.isArray(n)?n:g(n),o=r.length-1,l=e,i=0;i<o;i+=1){var u=r[i];if(null==a.get(l,u)&&(p(r[i+1])?a.set(l,u,[]):a.set(l,u,{})),l=a.get(l,u),!a.isObservable(l))return}a.isObservable(l)&&a.set(l,r[o],t)}var h={append:Object(a.action)((function(e,n){var t;null==e.values&&(e.values=[]),e.values.push(null!==(t=null==n?void 0:n(e))&&void 0!==t?t:{})})),delete:Object(a.action)((function(e,n){s()(Array.isArray(e._proxy.subModels),"arrayModel.subModels should be Array or observable.array"),e.values.splice(n,1),e._proxy.subModels.splice(n,1),c(e._proxy)})),moveUp:Object(a.action)((function(e,n){0!==n&&(s()(Array.isArray(e._proxy.subModels),"arrayModel.subModels should be Array or observable.array"),m(e.values,n,n-1),m(e._proxy.subModels,n,n-1),c(e._proxy))})),moveDown:Object(a.action)((function(e,n){n!==e.values.length-1&&(s()(Array.isArray(e._proxy.subModels),"arrayModel.subModels should be Array or observable.array"),m(e.values,n,n+1),m(e._proxy.subModels,n,n+1),c(e._proxy))})),clear:Object(a.action)((function(e){null!=e.values&&0!==e.values.length&&(s()(Array.isArray(e._proxy.subModels),"arrayModel.subModels should be Array or observable.array"),e.values=[],e._proxy.subModels.length=0)})),dragAndDrop:Object(a.action)((function(e,n,t){s()(Array.isArray(e._proxy.subModels),"arrayModel.subModels should be Array or observable.array"),d(e.values,n,t),d(e._proxy.subModels,n,t),c(e._proxy)})),renderArrayItem:function(e,n,t){return i.a.createElement(C,{name:String(n)},t)},getKey:function(e,n){return e.getSubModel(String(n)).id}};function v(e,n){return void 0!==e?e:n}function g(e){return e.split(".")}try{f.displayName="keyToValueShape",f.__docgenInfo={description:"",displayName:"keyToValueShape",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/utils.tsx#keyToValueShape"]={docgenInfo:f.__docgenInfo,name:"keyToValueShape",path:"../xform/src/core/utils.tsx#keyToValueShape"})}catch(Z){}try{y.displayName="observableGetIn",y.__docgenInfo={description:"lodash.get(...) for mobx observables",displayName:"observableGetIn",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/utils.tsx#observableGetIn"]={docgenInfo:y.__docgenInfo,name:"observableGetIn",path:"../xform/src/core/utils.tsx#observableGetIn"})}catch(Z){}try{b.displayName="observableSetIn",b.__docgenInfo={description:"lodash.set(...) for mobx observables",displayName:"observableSetIn",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/utils.tsx#observableSetIn"]={docgenInfo:b.__docgenInfo,name:"observableSetIn",path:"../xform/src/core/utils.tsx#observableSetIn"})}catch(Z){}try{v.displayName="composeState",v.__docgenInfo={description:"\u5408\u5e76\u53d7\u63a7\u72b6\u6001\u548c \u975e\u53d7\u63a7\u72b6\u6001",displayName:"composeState",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/utils.tsx#composeState"]={docgenInfo:v.__docgenInfo,name:"composeState",path:"../xform/src/core/utils.tsx#composeState"})}catch(Z){}try{g.displayName="splitToPath",g.__docgenInfo={description:"",displayName:"splitToPath",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/utils.tsx#splitToPath"]={docgenInfo:g.__docgenInfo,name:"splitToPath",path:"../xform/src/core/utils.tsx#splitToPath"})}catch(Z){}var S=i.a.createContext(null),O=S.Provider,_=i.a.createContext({}),E=function(e){var n=e.children,t=Object(r.a)(e,["children"]),a=x();return i.a.createElement(_.Provider,{value:Object.assign({},a,t)},n)};function x(){return Object(l.useContext)(_)}function F(){return Object(l.useContext)(S)}var V=Object(o.a)((function(e){var n,t,r=e.name,a=e.children,o=e.layout,l=e.itemFactory,u=F();if("&"===r)throw new Error("XFormArray \u4e0d\u652f\u6301 name=&. path=("+(u.path.join(".")||"root")+")");var s=u.getSubArray(r),c=null!==(t=null===(n=s.values)||void 0===n?void 0:n.length)&&void 0!==t?t:0;return i.a.createElement(O,{value:s},o({arrayModel:s,itemCount:c,itemContent:a,itemFactory:l}))})),C=Object(o.a)((function(e){var n=e.name,t=e.children,r=F();return"&"===n?i.a.createElement(i.a.Fragment,null,t):i.a.createElement(O,{value:r.getSubModel(n),children:t})})),w=Object(o.a)((function(e){var n=e.name,t=e.required,r=e.children,o=e.defaultValue,l=F(),i=Object(a.computed)((function(){return"&"===n?l._asField():l.getField(n)})).get();i._useTrack(e);var u=v(i.value,o);return r({model:l,name:n,field:i,value:u,required:t,defaultValue:o})}));try{O.displayName="ModelProvider",O.__docgenInfo={description:"",displayName:"ModelProvider",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/components.tsx#ModelProvider"]={docgenInfo:O.__docgenInfo,name:"ModelProvider",path:"../xform/src/core/components.tsx#ModelProvider"})}catch(Z){}try{E.displayName="FormEnvProvider",E.__docgenInfo={description:"",displayName:"FormEnvProvider",props:{isPreview:{defaultValue:null,description:"",name:"isPreview",required:!1,type:{name:"boolean"}},onSubmit:{defaultValue:null,description:"",name:"onSubmit",required:!1,type:{name:"(submitValues: any, model: FormModel<unknown>) => void"}},onError:{defaultValue:null,description:"",name:"onError",required:!1,type:{name:"(errors: any, model: FormModel<unknown>) => void"}},onReset:{defaultValue:null,description:"",name:"onReset",required:!1,type:{name:"(model: FormModel<unknown>) => void"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/components.tsx#FormEnvProvider"]={docgenInfo:E.__docgenInfo,name:"FormEnvProvider",path:"../xform/src/core/components.tsx#FormEnvProvider"})}catch(Z){}try{V.displayName="XFormArray",V.__docgenInfo={description:"\u5bf9\u8c61\u6570\u7ec4\u8868\u5355",displayName:"XFormArray",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},layout:{defaultValue:null,description:"",name:"layout",required:!0,type:{name:"(input: XFormArrayLayoutInput) => ReactElement<any, string | JSXElementConstructor<any>>"}},itemFactory:{defaultValue:null,description:"",name:"itemFactory",required:!1,type:{name:"(arrayModel: SubModel<unknown[]>) => any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/components.tsx#XFormArray"]={docgenInfo:V.__docgenInfo,name:"XFormArray",path:"../xform/src/core/components.tsx#XFormArray"})}catch(Z){}try{C.displayName="XFormObject",C.__docgenInfo={description:"\u4e3a\u8be5\u7ec4\u4ef6\u4e0b\u7684 XFormField \u6dfb\u52a0\u4e00\u4e2a\u6570\u636e\u5b57\u6bb5\u524d\u7f00",displayName:"XFormObject",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/components.tsx#XFormObject"]={docgenInfo:C.__docgenInfo,name:"XFormObject",path:"../xform/src/core/components.tsx#XFormObject"})}catch(Z){}try{w.displayName="XFormField",w.__docgenInfo={description:"\u8868\u5355\u5b57\u6bb5\uff08field\uff09\n\n\u5728 xform \u4e2d\uff0c\u4e00\u4e2a\u300c\u5b57\u6bb5\u300d\u5305\u542b\u4e00\u4e2a\u300c\u89c6\u56fe\u63a7\u4ef6\u5b9e\u4f8b\u300d\uff08\u4f8b\u5982 Input\uff0cSelect \u5b9e\u4f8b\uff09\u548c\u4e00\u4efd\u72b6\u6001\uff08\u4f8b\u5982 Input \u5305\u542b\u4e00\u4e2a\u5b57\u7b26\u4e32\u72b6\u6001\uff09\uff1b\nXFormField \u662f\u4e00\u4e2a\u9ad8\u9636\u7ec4\u4ef6 / \u57fa\u7840\u7ec4\u4ef6\uff0c\u6bcf\u4e2a\u5177\u4f53\u7684\u7ec4\u4ef6\u7c7b\u578b\uff08\u4f8b\u5982 Input\uff0cSelect \uff09\u90fd\u5e94\u8be5\u7ee7\u627f\u8be5\u7ec4\u4ef6\u5e76\u5c01\u88c5\u76f8\u5e94\u7684 FieldItem\uff1b",displayName:"XFormField",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"ReactNode"}},labelWidth:{defaultValue:null,description:"",name:"labelWidth",required:!1,type:{name:"string"}},help:{defaultValue:null,description:"",name:"help",required:!1,type:{name:"ReactNode"}},validator:{defaultValue:null,description:"",name:"validator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},required:{defaultValue:null,description:"",name:"required",required:!1,type:{name:"boolean"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"any"}},isEmpty:{defaultValue:null,description:"",name:"isEmpty",required:!1,type:{name:"(value: any) => boolean"}},requiredMessage:{defaultValue:null,description:"",name:"requiredMessage",required:!1,type:{name:"string"}},blurValidator:{defaultValue:null,description:"",name:"blurValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},changeValidator:{defaultValue:null,description:"",name:"changeValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},status:{defaultValue:null,description:"",name:"status",required:!1,type:{name:"string"}},renderPreview:{defaultValue:null,description:"",name:"renderPreview",required:!1,type:{name:"(props: any) => ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/core/components.tsx#XFormField"]={docgenInfo:w.__docgenInfo,name:"XFormField",path:"../xform/src/core/components.tsx#XFormField"})}catch(Z){}var A=t(217),I=function(){function e(e,n){this.fieldMap=new Map,this.model=e,this.valueShape=n,this.subModels="array"===n?[]:{}}var n=e.prototype;return n.iterateModels=function(e){!function n(t){Object.values(t.subModels).forEach((function(t){e(t),n(t._proxy)}))}(this)},n.iterateFields=function(e){this.fieldMap.forEach(e),this.iterateModels((function(n){n._proxy.fieldMap.forEach(e)}))},n.getSubModel=function(e,n){void 0===n&&(n="object");for(var t=Array.isArray(e)?e:g(e),r=this.model,a=0;a<t.length-1;a++)r=r._proxy._getSubModel(t[a],f(t[a+1]));return r._proxy._getSubModel(t[t.length-1],n)},n._getSubModel=function(e,n){void 0===n&&(n="object"),s()(!e.includes("."),"name \u4e2d\u4e0d\u80fd\u5305\u542b .");var t=this.subModels[e];return null==t&&(t=new j(this.model,e,n),this.subModels[e]=t),t},n.getField=function(e){var n=Array.isArray(e)?e:g(e);if(n.length>1)return this.getSubModel(n[0],f(n[1])).getField(n.slice(1));var t=n[0],r=this.fieldMap.get(t);return null==r&&(r=new k(this.model,t),this.fieldMap.set(t,r)),r},e}(),R=[],T=function(){function e(e){void 0===e&&(e={}),this._nextModelId=1,this._nextFieldId=1,this.state={},this.root=this,this.parent=this,this.path=R,this.valueShape="object",this._proxy=new I(this,"object"),this.values=e,Object(a.makeObservable)(this,{values:a.observable,state:a.observable,setValue:a.action})}var n=e.prototype;return n.getNextModelId=function(){return"Model_"+this._nextModelId++},n.getNextFieldId=function(){return"Field_"+this._nextFieldId++},n.getValue=function(e,n){return y(this.values,e,n)},n.setValue=function(e,n){b(this.values,e,n)},n.getSubModel=function(e){return this._proxy.getSubModel(e,"object")},n.getSubArray=function(e){return this._proxy.getSubModel(e,"array")},n.getField=function(e){return this._proxy.getField(e)},n._asField=function(){throw new Error("FormModel \u4e0b\u4e0d\u652f\u6301\u4f7f\u7528 name=& \u7684 Field")},e}(),j=function(){function e(e,n,t){this.state={},s()(!n.includes("."),"name \u4e2d\u4e0d\u80fd\u5305\u542b ."),this.root=e.root,this.parent=e,this.name=n,this.valueShape=t,this._proxy=new I(this,t),this.id=this.root.getNextModelId(),Object(a.makeObservable)(this,{values:a.computed,state:a.observable,setValue:a.action,name:a.observable},{name:this.id+"("+this.name+")"})}var n=e.prototype;return n.getSubModel=function(e){return this._proxy.getSubModel(e,"object")},n.getSubArray=function(e){return this._proxy.getSubModel(e,"array")},n.getField=function(e){return this._proxy.getField(e)},n.getValue=function(e,n){return y(this.values,e,n)},n.setValue=function(e,n){null==this.values&&(this.values="array"===this.valueShape?[]:{}),b(this.values,e,n)},n._asField=function(){return this.parent.getField(this.name)},Object(A.a)(e,[{key:"path",get:function(){return[].concat(this.parent.path,[this.name])}},{key:"values",get:function(){return this.parent.getValue(this.name)},set:function(e){this.parent.setValue(this.name,e)}}]),e}(),k=function(){function e(e,n){this.config=null,this.mountCount=0,this.state={},this.parent=e,this.name=n,this.id=this.parent.root.getNextFieldId(),Object(a.makeObservable)(this,{state:a.observable,name:a.observable.ref,value:a.computed,path:a.computed,config:!1,mountCount:!1},{name:this.id+"("+this.name+")"})}return e.prototype._useTrack=function(e){var n=this;Object(l.useLayoutEffect)((function(){return n.config=e,n.mountCount+=1,function(){n.config=null,n.mountCount-=1}}),[e])},Object(A.a)(e,[{key:"value",get:function(){return this.parent.getValue(this.name)},set:function(e){this.parent.setValue(this.name,e)}},{key:"path",get:function(){return this.parent.path.concat([this.name])}}]),e}(),P=t(159),M={validate:Object(a.action)((function(e,n){var t,r,o,l;if(void 0===n&&(n="*"),null!=e.config){var i=e.config,u=i.validator,s=i.required,c=i.defaultValue,d=i.isEmpty,m=i.requiredMessage,p=void 0===m?"\u8be5\u5b57\u6bb5\u4e3a\u5fc5\u586b\u9879":m,f=i.blurValidator,y=i.changeValidator,b=e.value;if(s&&d(b))return e.state.error=p,null===(r=(t=e.state).cancelValidation)||void 0===r||r.call(t),e.state.cancelValidation=null,Promise.resolve(p);var h=v(b,c),g=[("*"===n||"change"===n)&&(null==y?void 0:y(h,e)),("*"===n||"blur"===n)&&(null==f?void 0:f(h,e)),null==u?void 0:u(h,e)].filter(Boolean),S=!1;return null===(l=(o=e.state).cancelValidation)||void 0===l||l.call(o),e.state.validating=!0,e.state.cancelValidation=function(){e.state.validating=!1,S=!0},Promise.all(g).then(Object(a.action)((function(n){if(!S){e.state.cancelValidation=null,e.state.validating=!1;var t=n.filter(Boolean)[0];return e.state.error=t,t}})))}})),handleBlur:function(e){M.validate(e,"blur")},handleChange:Object(a.action)((function(e,n){e.value=n,M.validate(e,"change")}))},q={clearError:Object(a.action)((function(e){e._proxy.iterateFields((function(e){e.state.error=null}))})),validateAll:Object(a.action)((function(e,n){void 0===n&&(n="*");var t=!1,r=Object(a.observable)("array"===e.valueShape?[]:{}),o=[];return e._proxy.iterateFields((function(e){0!==e.mountCount&&o.push(M.validate(e,n).then(Object(a.action)((function(n){n&&(t=!0,b(r,e.path,n))}))))})),Promise.all(o).then((function(){return{hasError:t,errors:Object(a.toJS)(r)}}))})),submit:Object(a.action)((function(e,n){var t=n.onError,r=n.onSubmit,o=n.valueFilter;q.validateAll(e).then(Object(a.action)((function(n){var l=n.hasError,i=n.errors;if(l)null==t||t(i,e);else if("function"==typeof r)if("all"===o)r(Object(a.toJS)(e.values),e);else{var u=Object(a.observable)("array"===e.valueShape?[]:{});e._proxy.iterateFields((function(e){0!==e.mountCount&&void 0!==e.value&&b(u,e.path,e.value)})),r(Object(a.toJS)(u),e)}})))})),reset:Object(a.action)((function(e,n){var t=n.onReset;e.values={},q.clearError(e),null==t||t(e)}))};function B(e){var n=e.model,t=e.defaultValue,r=e.isPreview,a=e.layout,o=void 0===a?{labelPosition:"left"}:a,u=e.onSubmit,s=e.onError,c=e.onReset,d=e.children,m=e.className,p=e.style,f=v(n,Object(l.useState)((function(){return new T(t)}))[0]);return i.a.createElement(E,{isPreview:r,onError:s,onReset:c,onSubmit:u},i.a.createElement(O,{value:f},i.a.createElement(P.FormLayout,Object.assign({},o,{style:p,className:m}),d)))}var L=Object(o.a)((function(e){var n=e.watch,t=e.effect,r=F(),o=r.getField(n);return Object(l.useEffect)((function(){return Object(a.reaction)((function(){return Object(a.toJS)(o.value)}),(function(e,n){return t(e,{model:r,prev:n,next:e})}))}),[r,n,o,t]),null})),N=Object(o.a)((function(e){return(0,e.children)(F())}));B.Submit=function(e){var n=e.type,t=void 0===n?"primary":n,a=e.children,o=void 0===a?"\u63d0\u4ea4":a,l=Object(r.a)(e,["type","children"]),u=F().root,s=x();return i.a.createElement(P.Button,Object.assign({onClick:function(){return q.submit(u,Object.assign({},s,{valueFilter:"mounted"}))},type:t,children:o},l))},B.Reset=function(e){var n=e.children,t=void 0===n?"\u91cd\u7f6e":n,o=Object(r.a)(e,["children"]),l=F().root,u=x();return i.a.createElement(P.Button,Object.assign({onClick:Object(a.action)((function(){return q.reset(l,u)})),children:t},o))},B.Effect=L,B.Array=V,B.Object=C,B.Field=w,B.ModelProvider=O,B.ModelConsumer=N;try{B.displayName="Form",B.__docgenInfo={description:"",displayName:"Form",props:{model:{defaultValue:null,description:"\u53d7\u63a7\u7528\u6cd5\u3002 xform \u6a21\u578b\u5bf9\u8c61\uff0c\u4e00\u822c\u7531\u4e0a\u5c42\u901a\u8fc7 new FormModel(...) \u521b\u5efa\u800c\u6210",name:"model",required:!1,type:{name:"IModel<unknown>"}},defaultValue:{defaultValue:null,description:"\u975e\u53d7\u63a7\u7528\u6cd5\u3002 \u8868\u5355\u7684\u9ed8\u8ba4\u503c",name:"defaultValue",required:!1,type:{name:"any"}},onSubmit:{defaultValue:null,description:"\u63d0\u4ea4\u8868\u5355\u65f6\u7684\u56de\u8c03\u51fd\u6570\uff0c\u9700\u914d\u5408 <Form.Submit /> \u4f7f\u7528",name:"onSubmit",required:!1,type:{name:"(submitValues: any, model: FormModel<unknown>) => void"}},onError:{defaultValue:null,description:"\u63d0\u4ea4\u8868\u5355\u65f6\u7684\u51fa\u9519\u56de\u8c03\u51fd\u6570\uff0c\u9700\u914d\u5408 <Form.Submit /> \u4f7f\u7528",name:"onError",required:!1,type:{name:"(errors: any, model: FormModel<unknown>) => void"}},onReset:{defaultValue:null,description:"\u6e05\u7a7a\u8868\u5355\u65f6\u7684\u56de\u8c03\u51fd\u6570\uff0c\u9700\u914d\u5408 <Form.Reset /> \u4f7f\u7528",name:"onReset",required:!1,type:{name:"(model: FormModel<unknown>) => void"}},isPreview:{defaultValue:{value:"false"},description:"\u662f\u5426\u4e3a\u9884\u89c8\u6001",name:"isPreview",required:!1,type:{name:"boolean"}},layout:{defaultValue:{value:"{ labelPosition: 'left' }"},description:"\u5e03\u5c40\u53c2\u6570\n@category \u5e03\u5c40",name:"layout",required:!1,type:{name:'{ isInline?: boolean; labelPosition?: "top" | "left"; }'}},style:{defaultValue:null,description:"@category \u5e03\u5c40",name:"style",required:!1,type:{name:"CSSProperties"}},className:{defaultValue:null,description:"@category \u5e03\u5c40",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form"]={docgenInfo:B.__docgenInfo,name:"Form",path:"../xform/src/form.tsx#Form"})}catch(Z){}try{B.Submit.displayName="Form.Submit",B.Submit.__docgenInfo={description:"",displayName:"Form.Submit",props:{shape:{defaultValue:null,description:"",name:"shape",required:!1,type:{name:'"solid" | "text" | "link" | "warning" | "ghost"'}},type:{defaultValue:{value:"primary"},description:"",name:"type",required:!1,type:{name:'"normal" | "primary" | "secondary"'}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:'"small" | "medium" | "large"'}},htmlType:{defaultValue:null,description:"",name:"htmlType",required:!1,type:{name:'"button" | "submit" | "reset"'}},isFullWidth:{defaultValue:null,description:"",name:"isFullWidth",required:!1,type:{name:"boolean"}},isIconOnly:{defaultValue:null,description:"\u662f\u5426\u4e3a\u7eaf\u56fe\u6807\u6309\u94ae",name:"isIconOnly",required:!1,type:{name:"boolean"}},isSelected:{defaultValue:null,description:"",name:"isSelected",required:!1,type:{name:"boolean"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},leftElement:{defaultValue:null,description:"",name:"leftElement",required:!1,type:{name:"ReactNode"}},rightElement:{defaultValue:null,description:"",name:"rightElement",required:!1,type:{name:"ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Submit"]={docgenInfo:B.Submit.__docgenInfo,name:"Form.Submit",path:"../xform/src/form.tsx#Form.Submit"})}catch(Z){}try{B.Reset.displayName="Form.Reset",B.Reset.__docgenInfo={description:"",displayName:"Form.Reset",props:{shape:{defaultValue:null,description:"",name:"shape",required:!1,type:{name:'"solid" | "text" | "link" | "warning" | "ghost"'}},type:{defaultValue:null,description:"",name:"type",required:!1,type:{name:'"normal" | "primary" | "secondary"'}},size:{defaultValue:null,description:"",name:"size",required:!1,type:{name:'"small" | "medium" | "large"'}},htmlType:{defaultValue:null,description:"",name:"htmlType",required:!1,type:{name:'"button" | "submit" | "reset"'}},isFullWidth:{defaultValue:null,description:"",name:"isFullWidth",required:!1,type:{name:"boolean"}},isIconOnly:{defaultValue:null,description:"\u662f\u5426\u4e3a\u7eaf\u56fe\u6807\u6309\u94ae",name:"isIconOnly",required:!1,type:{name:"boolean"}},isSelected:{defaultValue:null,description:"",name:"isSelected",required:!1,type:{name:"boolean"}},loading:{defaultValue:null,description:"",name:"loading",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},leftElement:{defaultValue:null,description:"",name:"leftElement",required:!1,type:{name:"ReactNode"}},rightElement:{defaultValue:null,description:"",name:"rightElement",required:!1,type:{name:"ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Reset"]={docgenInfo:B.Reset.__docgenInfo,name:"Form.Reset",path:"../xform/src/form.tsx#Form.Reset"})}catch(Z){}try{B.Effect.displayName="Form.Effect",B.Effect.__docgenInfo={description:"",displayName:"Form.Effect",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Effect"]={docgenInfo:B.Effect.__docgenInfo,name:"Form.Effect",path:"../xform/src/form.tsx#Form.Effect"})}catch(Z){}try{B.Array.displayName="Form.Array",B.Array.__docgenInfo={description:"",displayName:"Form.Array",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},layout:{defaultValue:null,description:"",name:"layout",required:!0,type:{name:"(input: XFormArrayLayoutInput) => ReactElement<any, string | JSXElementConstructor<any>>"}},itemFactory:{defaultValue:null,description:"",name:"itemFactory",required:!1,type:{name:"(arrayModel: SubModel<unknown[]>) => any"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Array"]={docgenInfo:B.Array.__docgenInfo,name:"Form.Array",path:"../xform/src/form.tsx#Form.Array"})}catch(Z){}try{B.Object.displayName="Form.Object",B.Object.__docgenInfo={description:"",displayName:"Form.Object",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Object"]={docgenInfo:B.Object.__docgenInfo,name:"Form.Object",path:"../xform/src/form.tsx#Form.Object"})}catch(Z){}try{B.Field.displayName="Form.Field",B.Field.__docgenInfo={description:"",displayName:"Form.Field",props:{name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"ReactNode"}},labelWidth:{defaultValue:null,description:"",name:"labelWidth",required:!1,type:{name:"string"}},help:{defaultValue:null,description:"",name:"help",required:!1,type:{name:"ReactNode"}},validator:{defaultValue:null,description:"",name:"validator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},required:{defaultValue:null,description:"",name:"required",required:!1,type:{name:"boolean"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"any"}},isEmpty:{defaultValue:null,description:"",name:"isEmpty",required:!1,type:{name:"(value: any) => boolean"}},requiredMessage:{defaultValue:null,description:"",name:"requiredMessage",required:!1,type:{name:"string"}},blurValidator:{defaultValue:null,description:"",name:"blurValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},changeValidator:{defaultValue:null,description:"",name:"changeValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},status:{defaultValue:null,description:"",name:"status",required:!1,type:{name:"string"}},renderPreview:{defaultValue:null,description:"",name:"renderPreview",required:!1,type:{name:"(props: any) => ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.Field"]={docgenInfo:B.Field.__docgenInfo,name:"Form.Field",path:"../xform/src/form.tsx#Form.Field"})}catch(Z){}try{B.ModelConsumer.displayName="Form.ModelConsumer",B.ModelConsumer.__docgenInfo={description:"",displayName:"Form.ModelConsumer",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form.tsx#Form.ModelConsumer"]={docgenInfo:B.ModelConsumer.__docgenInfo,name:"Form.ModelConsumer",path:"../xform/src/form.tsx#Form.ModelConsumer"})}catch(Z){}function K(e){return e.value?"\u662f":"\u5426"}function J(e){return e.value}function Y(e){return!e}function z(e){return null==e}function G(e){return null==e||Array.isArray(e)&&0===e.length}var X={};function U(e,n){function t(t){var a=t.defaultValue,o=void 0===a?n.fallbackValue:a,l=t.componentProps,u=t.value,s=t.onChange,c=t.onBlur,d=Object(r.a)(t,["defaultValue","componentProps","value","onChange","onBlur"]),m=x().isPreview;return i.a.createElement(w,Object.assign({defaultValue:o,isEmpty:n.isEmpty},d),(function(t){t.model,t.name;var r,a=t.field,o=t.value,p=t.required,f=a.state.error,y=Object.assign({},Object(P.pick)(d,["dataSource","readOnly","disabled"]),l,{status:v(null==l?void 0:l.status,v(d.status,f?"error":void 0)),value:void 0!==u?u:o,onChange:void 0!==s?s:function(e){return M.handleChange(a,e)},onBlur:void 0!==c?c:function(){return M.handleBlur(a)}});return i.a.createElement(P.FormControl,{label:d.label,help:d.help,labelWidth:d.labelWidth,required:p,error:f},m?(null!==(r=d.renderPreview)&&void 0!==r?r:n.renderPreview)(y):i.a.createElement(e,Object.assign({},y)))}))}t.displayName="FormItem("+n.name+")",X[n.name]=t}function W(e){var n=e.component,t=Object(r.a)(e,["component"]),a=X[n];return null==a?i.a.createElement(P.FormControl,null,i.a.createElement("div",{style:{border:"1px dashed var(--rex-colors-error-hover)",fontSize:14,padding:4,color:"var(--rex-colors-error-normal)"}},i.a.createElement("code",null,"<FormItem component='",n,"' />")," \u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7ec4\u4ef6\uff0c\u8bf7\u68c0\u67e5\u7ec4\u4ef6\u540d\u79f0\u662f\u5426\u62fc\u5199\u6b63\u786e")):i.a.createElement(a,t)}U(P.Switch,{name:"switch",renderPreview:K,fallbackValue:!1,isEmpty:Y}),U(P.Checkbox,{name:"checkbox",renderPreview:K,fallbackValue:!1,isEmpty:Y}),U(P.CheckboxGroup,{name:"checkboxGroup",fallbackValue:[],renderPreview:function(e){var n,t=null!==(n=e.value)&&void 0!==n?n:e.defaultValue,r=new P.ListStore(e.dataSource);return t.map((function(e){var n=r.getItem(e);return n?n.label:e})).join("\u3001")},isEmpty:function(e){return null==e||0===e.length}}),U(P.RadioGroup,{name:"radioGroup",fallbackValue:null,renderPreview:function(e){var n,t=null!==(n=e.value)&&void 0!==n?n:e.defaultValue,r=new P.ListStore(e.dataSource).getItem(t);return r?r.label:t},isEmpty:Y}),U(P.DatePicker,{name:"datePicker",renderPreview:J,fallbackValue:null,isEmpty:Y}),U(P.DateRangePicker,{name:"dateRangePicker",renderPreview:function(e){var n,t=(null!==(n=e.value)&&void 0!==n?n:e.defaultValue)||[];return(t[0]||"-")+" ~ "+(t[1]||"-")},fallbackValue:[],isEmpty:G}),U(P.TimePicker,{name:"timePicker",renderPreview:J,fallbackValue:"",isEmpty:Y}),U(P.FilePicker,{name:"filePicker",renderPreview:function(e){var n,t=(null!==(n=e.value)&&void 0!==n?n:e.defaultValue)||[];return i.a.createElement(P.Flex,{spacing:"s",direction:"column"},t.map((function(e){var n=e.id,t=e.name,r=e.url;return i.a.createElement(P.FlexItem,{key:n,bg:"fill.layer1",px:"m"},i.a.createElement(P.Link,{href:r},t))})))},fallbackValue:[],isEmpty:G}),U(P.MediaPicker,{name:"mediaPicker",renderPreview:function(e){var n,t=(null!==(n=e.value)&&void 0!==n?n:e.defaultValue)||[];return i.a.createElement(P.Flex,{spacing:"m"},t.map((function(e){var n=e.id,t=e.name,r=e.url,a=Object(P.colors)("fill.layer1")+" url("+r+") center center / 100% no-repeat";return i.a.createElement(P.Box,{key:n,size:"100px",title:t,display:"inline-block",style:{background:a}})})))},fallbackValue:[],isEmpty:G}),U(P.Input,{name:"input",renderPreview:J,fallbackValue:"",isEmpty:Y}),U(P.Textarea,{name:"textarea",renderPreview:J,fallbackValue:"",isEmpty:Y}),U(P.NumberInput,{name:"numberInput",renderPreview:J,fallbackValue:null,isEmpty:z}),U(P.Range,{name:"range",renderPreview:J,fallbackValue:0,isEmpty:z}),U(P.Select,{name:"select",renderPreview:J,fallbackValue:null,isEmpty:z}),U(P.SingleSelect,{name:"singleSelect",renderPreview:J,fallbackValue:null,isEmpty:Y}),U(P.MultiSelect,{name:"multiSelect",renderPreview:J,fallbackValue:[],isEmpty:G}),U(P.TreeSelect,{name:"treeSelect",renderPreview:J,fallbackValue:null,isEmpty:G}),U(P.SingleTreeSelect,{name:"singleTreeSelect",renderPreview:J,fallbackValue:null,isEmpty:Y}),U(P.MultiTreeSelect,{name:"multiTreeSelect",renderPreview:J,fallbackValue:[],isEmpty:G}),U((function(e){var n=e.items,t=e.value,a=e.onChange,o=Object(r.a)(e,["items","value","onChange"]);return i.a.createElement("div",Object.assign({style:{display:"flex",gap:8}},o),n.map((function(e){return i.a.createElement(P.Button,{key:e,type:e===t?"primary":"normal",onClick:function(){return a(e)}},e)})))}),{name:"testButtonGroup",fallbackValue:"",renderPreview:J,isEmpty:Y});try{W.displayName="FormItem",W.__docgenInfo={description:"",displayName:"FormItem",props:{component:{defaultValue:null,description:"",name:"component",required:!0,type:{name:'"radioGroup" | "input" | "select" | "textarea" | "switch" | "singleSelect" | "multiSelect" | "treeSelect" | "checkbox" | "checkboxGroup" | "datePicker" | "dateRangePicker" | ... 7 more ... | "testButtonGroup"'}},componentProps:{defaultValue:null,description:"",name:"componentProps",required:!1,type:{name:"TextareaProps | TimePickerProps | SwitchProps | RangeProps | SelectProps | MultiSelectProps | ... 11 more ... | (HTMLProps<...> & { ...; })"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"any"}},name:{defaultValue:null,description:"",name:"name",required:!0,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!1,type:{name:"ReactNode"}},labelWidth:{defaultValue:null,description:"",name:"labelWidth",required:!1,type:{name:"string"}},help:{defaultValue:null,description:"",name:"help",required:!1,type:{name:"ReactNode"}},validator:{defaultValue:null,description:"",name:"validator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},required:{defaultValue:null,description:"",name:"required",required:!1,type:{name:"boolean"}},isEmpty:{defaultValue:null,description:"",name:"isEmpty",required:!1,type:{name:"(value: any) => boolean"}},requiredMessage:{defaultValue:null,description:"",name:"requiredMessage",required:!1,type:{name:"string"}},blurValidator:{defaultValue:null,description:"",name:"blurValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},changeValidator:{defaultValue:null,description:"",name:"changeValidator",required:!1,type:{name:"(value: any, field: Field) => string | Promise<string>"}},disabled:{defaultValue:null,description:"",name:"disabled",required:!1,type:{name:"boolean"}},readOnly:{defaultValue:null,description:"",name:"readOnly",required:!1,type:{name:"boolean"}},status:{defaultValue:null,description:"",name:"status",required:!1,type:{name:"string"}},renderPreview:{defaultValue:null,description:"",name:"renderPreview",required:!1,type:{name:"(props: any) => ReactNode"}},dataSource:{defaultValue:null,description:"",name:"dataSource",required:!1,type:{name:"ListNode<string>[] | (string | SelectItem)[] | TreeSelectItem[] | ListNode<StringOrNumber>[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/form-item.tsx#FormItem"]={docgenInfo:W.__docgenInfo,name:"FormItem",path:"../xform/src/form-item.tsx#FormItem"})}catch(Z){}var D=function(e){for(var n=[],t=0;t<e;t++)n.push(t);return n},H=function(e){var n=void 0===e?{}:e,t=n.title,r=n.showItemCount,o=n.showItemOrder,l=n.style,u={position:"absolute",top:8,right:8,display:"flex",gap:8,zIndex:20};return function(e){var n=e.arrayModel,s=e.itemContent,c=e.itemCount,d=e.itemFactory;return i.a.createElement("div",{className:"xform-array",style:Object.assign({marginTop:16,marginBottom:8},l)},(t||r)&&i.a.createElement("h2",null,null!=t?t:"\u5217\u8868"," ",r&&"("+c+")"),0===c&&i.a.createElement("div",{style:{border:"1px dashed #aaa",marginTop:16,padding:8,position:"relative",fontSize:20}},"\u7a7a\u7a7a\u5982\u4e5f~~"),i.a.createElement("div",{className:"xform-array-items"},D(c).map((function(t){return i.a.createElement("div",{key:h.getKey(n,t),className:"xform-array-item",style:{border:"1px dashed #aaa",marginTop:16,padding:8,position:"relative"}},o&&i.a.createElement("code",{style:{fontSize:16}},n.path.join("."),"#",t),i.a.createElement($,Object.assign({},e,{itemIndex:t,style:u})),h.renderArrayItem(n,t,s))}))),i.a.createElement("div",{style:{marginTop:12}},i.a.createElement(P.Button,{onClick:Object(a.action)((function(){h.append(n,d)}))},"\u6dfb\u52a0\u4e00\u9879")))}},$=Object(o.a)((function(e){var n=e.arrayModel,t=e.itemCount,r=e.itemIndex,o=e.style;return i.a.createElement("div",{style:o},i.a.createElement(P.Button,{size:"small",onClick:Object(a.action)((function(){h.delete(n,r)}))},"\u5220\u9664"),i.a.createElement(P.Button,{size:"small",disabled:0===r,onClick:Object(a.action)((function(){h.moveUp(n,r)}))},"\u4e0a\u79fb"),i.a.createElement(P.Button,{size:"small",disabled:r===t-1,onClick:Object(a.action)((function(){h.moveDown(n,r)}))},"\u4e0b\u79fb"))})),Q=function(e){var n=void 0===e?{}:e,t=n.defaultColumnWidth,r=n.orderColumn,a=n.operationColumn,o=n.className,l=n.style,u={display:"flex",gap:0};return function(e){var n=e.arrayModel,s=e.itemContent,c=e.itemCount,d=e.itemFactory,m=i.a.Children.toArray(s).filter((function(e){return e.type===W})).map((function(e){return Object.assign({name:"string"==typeof e.props.label?e.props.label:null,title:e.props.label},e.props["x-table-column"],{render:function(n,t){return i.a.createElement(C,{name:String(t.itemIndex)},i.a.cloneElement(e,{label:null,isInline:!0}))}})}));return null!=r&&m.unshift(Object.assign({name:"#"},r,{getValue:function(e){return e.itemIndex+1}})),null!=a&&m.push(Object.assign({name:""},a,{render:function(n,t){return i.a.createElement($,Object.assign({},e,{itemIndex:t.itemIndex,style:u}))}})),i.a.createElement("div",{style:l,className:o},i.a.createElement(P.BaseTable,{className:"bordered",primaryKey:"rowKey",defaultColumnWidth:t,dataSource:D(c).map((function(e){return{rowKey:h.getKey(n,e),itemIndex:e}})),columns:m}),i.a.createElement("div",{style:{padding:4,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"#f5f5f5"}},i.a.createElement(P.Button,{type:"primary",onClick:function(){h.append(n,d)}},"\u6dfb\u52a0\u4e00\u884c")))}};try{H.displayName="arrayCard",H.__docgenInfo={description:"",displayName:"arrayCard",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/array-layouts.tsx#arrayCard"]={docgenInfo:H.__docgenInfo,name:"arrayCard",path:"../xform/src/array-layouts.tsx#arrayCard"})}catch(Z){}try{Q.displayName="arrayTable",Q.__docgenInfo={description:"",displayName:"arrayTable",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../xform/src/array-layouts.tsx#arrayTable"]={docgenInfo:Q.__docgenInfo,name:"arrayTable",path:"../xform/src/array-layouts.tsx#arrayTable"})}catch(Z){}},309:function(e,n,t){"use strict";t.d(n,"a",(function(){return h}));var r=t(170),a=t(4),o=t(311),l=t(3),i=t(159),u=t(204),s=t(165),c=t(179),d=t(0),m=t.n(d);function p(e){var n=e.children,t=e.fallback;return"undefined"==typeof document||null==n?null!=t?t:null:m.a.createElement(m.a.Fragment,null,n())}var f={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/helpers.tsx",loc:{start:{line:9,column:0},end:{line:21,column:1}},name:"BrowserOnly",value:p,source:" function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } }function BrowserOnly({\n  children,\n  fallback,\n}\n\n\n) {\n  if (typeof document === 'undefined' || children == null) {\n    return _nullishCoalesce(fallback, () => ( null));\n  }\n\n  return <>{children()}</>;\n}",deps:function(){return[]},provides:{React:m.a}},y=function(e){return m.a.createElement(p,null,(function(){var n=t(371).default;return m.a.createElement(n,Object(l.a)({style:Object.assign({marginTop:8,fontSize:12},e.style)},e))}))},b={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/helpers.tsx",loc:{start:{line:23,column:7},end:{line:32,column:2}},name:"BrowserOnlyReactJson",value:y,source:"const BrowserOnlyReactJson = (props) => {\n  return (\n    <BrowserOnly>\n      {() => {\n        const ReactJson = require('react-json-view').default;\n        return <ReactJson style={{ marginTop: 8, fontSize: 12, ...props.style }} {...props} />;\n      }}\n    </BrowserOnly>\n  );\n};",deps:function(){return[f]},provides:{}};y.__doc_info=b,y.__inner_source="(props) => {\n  return (\n    <BrowserOnly>\n      {() => {\n        const ReactJson = require('react-json-view').default;\n        return <ReactJson style={{ marginTop: 8, fontSize: 12, ...props.style }} {...props} />;\n      }}\n    </BrowserOnly>\n  );\n}";var h=Object(c.a)((function(e){var n,t=e.style,r=e.defaultShow,a=Object(u.h)(),o=Object(s.toJS)(a.values),l=null!==(n=a.state.showReactJson)&&void 0!==n?n:r;return m.a.createElement("div",{style:Object.assign({marginTop:16},t)},m.a.createElement("div",{style:{marginTop:8,display:"flex",alignItems:"center",gap:8}},m.a.createElement(i.Switch,{value:l,onChange:Object(s.action)((function(e){a.state.showReactJson=e}))}),m.a.createElement("span",{style:{fontSize:12}},"\u663e\u793a JSON")),l&&m.a.createElement(y,{name:"\u8868\u5355\u72b6\u6001\u9884\u89c8",src:o}))})),v=(c.a,m.a,u.h,s.toJS,i.Switch,s.action,Object(c.a)((function(e){var n=e.label,t=e.printAll,r=Object(u.h)();return Object(d.useEffect)((function(){return Object(s.autorun)((function(){console.log("[ValuePrinter] "+(null!=n?n:"")+"\n",t?Object.assign({},r,{values:Object(s.toJS)(r.values)}):Object(s.toJS)(r.values))}))}),[n,r,t]),null}))),g=(c.a,u.h,d.useEffect,s.autorun,s.toJS,Object(c.a)((function(){var e=Object(u.h)().root;return m.a.createElement("div",{style:{display:"flex",gap:8}},m.a.createElement(i.Button,{onClick:function(){return u.g.validateAll(e)}},"\u6821\u9a8c\u5168\u90e8"),m.a.createElement(i.Button,{onClick:function(){return u.g.clearError(e)}},"\u6e05\u7a7a\u9519\u8bef"),m.a.createElement(i.Button,{onClick:Object(s.action)((function(){e.values={opCount:0,sku:{code:"test"}},u.g.clearError(e)}))},"\u91cd\u7f6e\u8868\u5355"))})),c.a,u.h,i.Button,u.g,s.action,Object(c.a)((function(){var e=Object(u.h)();return Object(d.useEffect)((function(){return window.model=e,window.toJS=s.toJS,window.mobx=s,function(){delete window.model,delete window.toJS,delete window.mobx}}),[e]),m.a.createElement(m.a.Fragment,null)})),c.a,u.h,d.useEffect,s.toJS,function(e){function n(){return e.apply(this,arguments)||this}return Object(a.a)(n,e),n}(Object(o.a)(Error))),S={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/helpers.tsx",loc:{start:null,end:null},name:"AsyncLoadingError",value:g,source:" function _nullishCoalesce(lhs, rhsFn) { if (lhs != null) { return lhs; } else { return rhsFn(); } } function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }import { Button, Switch } from '@rexd/core';\nimport { modelUtils, useModel } from '@rexd/xform';\nimport * as mobx from 'mobx';\nimport { action, autorun, computed, toJS } from 'mobx';\nimport { observer } from 'mobx-react-lite';\nimport React, { useEffect } from 'react';\n\n\nfunction BrowserOnly({\n  children,\n  fallback,\n}\n\n\n) {\n  if (typeof document === 'undefined' || children == null) {\n    return _nullishCoalesce(fallback, () => ( null));\n  }\n\n  return <>{children()}</>;\n}\n\nexport const BrowserOnlyReactJson = (props) => {\n  return (\n    <BrowserOnly>\n      {() => {\n        const ReactJson = require('react-json-view').default;\n        return <ReactJson style={{ marginTop: 8, fontSize: 12, ...props.style }} {...props} />;\n      }}\n    </BrowserOnly>\n  );\n};\n\n// https://github.com/mac-s-g/react-json-view/issues/121#issuecomment-670431408\n\nexport const ValuePreview = observer(\n  ({ style, defaultShow }) => {\n    const model = useModel();\n    const data = toJS(model.values) ;\n    const showReactJson = _nullishCoalesce(model.state.showReactJson, () => ( defaultShow));\n\n    return (\n      <div style={{ marginTop: 16, ...style }}>\n        <div style={{ marginTop: 8, display: 'flex', alignItems: 'center', gap: 8 }}>\n          <Switch\n            value={showReactJson}\n            onChange={action((b) => {\n              model.state.showReactJson = b;\n            })}\n          />\n          <span style={{ fontSize: 12 }}>\u663e\u793a JSON</span>\n        </div>\n        {showReactJson && <BrowserOnlyReactJson name=\"\u8868\u5355\u72b6\u6001\u9884\u89c8\" src={data} />}\n      </div>\n    );\n  },\n);\n\nexport const ValuePrinter = observer(({ label, printAll }) => {\n  const model = useModel();\n\n  useEffect(() => {\n    return autorun(() => {\n      console.log(\n        `[ValuePrinter] ${_nullishCoalesce(label, () => ( ''))}\\n`,\n        printAll ? { ...model, values: toJS(model.values) } : toJS(model.values),\n      );\n    });\n  }, [label, model, printAll]);\n\n  return null;\n});\n\nexport const Actions = observer(() => {\n  const model = useModel().root;\n\n  return (\n    <div style={{ display: 'flex', gap: 8 }}>\n      <Button onClick={() => modelUtils.validateAll(model)}>\u6821\u9a8c\u5168\u90e8</Button>\n      <Button onClick={() => modelUtils.clearError(model)}>\u6e05\u7a7a\u9519\u8bef</Button>\n      <Button\n        onClick={action(() => {\n          model.values = {\n            opCount: 0,\n            sku: { code: 'test' },\n          };\n          modelUtils.clearError(model);\n        })}\n      >\n        \u91cd\u7f6e\u8868\u5355\n      </Button>\n    </div>\n  );\n});\n\nexport const InjectModelToGlobal = observer(() => {\n  const model = useModel();\n\n  useEffect(() => {\n    // @ts-ignore\n    window.model = model;\n    // @ts-ignore\n    window.toJS = toJS;\n    // @ts-ignore\n    window.mobx = mobx;\n\n    return () => {\n      // @ts-ignore\n      delete window.model;\n      // @ts-ignore\n      delete window.toJS;\n      // @ts-ignore\n      delete window.mobx;\n    };\n  }, [model]);\n\n  return <></>;\n});\n\n\n\nclass AsyncLoadingError extends Error {}\n\n\n\n\n\n\n\n\nfunction getFromAsyncValue(x) {\n  if (x.status !== 'ready') {\n    throw new AsyncLoadingError();\n  }\n  return x.current;\n}\n\nexport function makeAsyncValue(getter, initValue) {\n  const atom = mobx.createAtom('atom@asyncSelect');\n  const disposers = [];\n\n  let status = 'loading';\n  let current = initValue;\n\n  const computedStatus = computed(() => {\n    atom.reportObserved();\n    return status;\n  });\n  const computedCurrent = computed(() => {\n    atom.reportObserved();\n    return current;\n  });\n\n  let reaction;\n  let cancelLastGetter;\n\n  const start = () => {\n    reaction = new mobx.Reaction('async', () => {\n      if (status !== 'loading') {\n        status = 'loading';\n        atom.reportChanged();\n      }\n\n      reaction.track(() => {\n        _optionalChain([cancelLastGetter, 'optionalCall', _ => _()]);\n\n        let cancelled = false;\n        cancelLastGetter = () => {\n          cancelled = true;\n        };\n\n        getter(getFromAsyncValue)\n          .then(\n            action((newValue) => {\n              if (cancelled) {\n                return;\n              }\n              status = 'ready';\n              current = newValue;\n              atom.reportChanged();\n\n              return newValue;\n            }),\n          )\n          .catch((e) => {\n            if (e instanceof AsyncLoadingError) {\n              // still loading, do nothing\n              return;\n            }\n            // TODO \u5904\u7406 error \u72b6\u6001\n            throw e;\n          });\n      });\n    });\n    reaction.schedule_();\n  };\n\n  const stop = () => {\n    if (reaction) {\n      reaction.dispose();\n      reaction = null;\n    }\n  };\n\n  disposers.push(mobx.onBecomeObserved(atom, start));\n  disposers.push(mobx.onBecomeUnobserved(atom, stop));\n  disposers.push(stop);\n\n  return {\n    get status() {\n      return computedStatus.get();\n    },\n    get current() {\n      return computedCurrent.get();\n    },\n    dispose() {\n      for (const fn of disposers) {\n        fn();\n      }\n    },\n    refresh() {\n      _optionalChain([reaction, 'optionalAccess', _2 => _2.onBecomeStale_, 'call', _3 => _3()]);\n    },\n  };\n}\n",deps:function(){return[]},provides:{}};function O(e){if("ready"!==e.status)throw new g;return e.current}var _={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/helpers.tsx",loc:{start:{line:131,column:0},end:{line:136,column:1}},name:"getFromAsyncValue",value:O,source:"function getFromAsyncValue(x) {\n  if (x.status !== 'ready') {\n    throw new AsyncLoadingError();\n  }\n  return x.current;\n}",deps:function(){return[S]},provides:{}};function E(e,n){var t,a,o=s.createAtom("atom@asyncSelect"),l=[],i="loading",u=n,c=Object(s.computed)((function(){return o.reportObserved(),i})),d=Object(s.computed)((function(){return o.reportObserved(),u})),m=function(){t&&(t.dispose(),t=null)};return l.push(s.onBecomeObserved(o,(function(){(t=new s.Reaction("async",(function(){"loading"!==i&&(i="loading",o.reportChanged()),t.track((function(){var n;null===(n=a)||void 0===n||n();var t=!1;a=function(){t=!0},e(O).then(Object(s.action)((function(e){if(!t)return i="ready",u=e,o.reportChanged(),e}))).catch((function(e){if(!(e instanceof g))throw e}))}))}))).schedule_()}))),l.push(s.onBecomeUnobserved(o,m)),l.push(m),{get status(){return c.get()},get current(){return d.get()},dispose:function(){for(var e,n=Object(r.a)(l);!(e=n()).done;){(0,e.value)()}},refresh:function(){var e;null===(e=t)||void 0===e||e.onBecomeStale_()}}}var x={filename:"/Users/feichao.sfc/code/github/alibaba/rex-design/packages/story/src/xform/helpers.tsx",loc:{start:{line:138,column:7},end:{line:225,column:1}},name:"makeAsyncValue",value:E,source:" function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }function makeAsyncValue(getter, initValue) {\n  const atom = mobx.createAtom('atom@asyncSelect');\n  const disposers = [];\n\n  let status = 'loading';\n  let current = initValue;\n\n  const computedStatus = computed(() => {\n    atom.reportObserved();\n    return status;\n  });\n  const computedCurrent = computed(() => {\n    atom.reportObserved();\n    return current;\n  });\n\n  let reaction;\n  let cancelLastGetter;\n\n  const start = () => {\n    reaction = new mobx.Reaction('async', () => {\n      if (status !== 'loading') {\n        status = 'loading';\n        atom.reportChanged();\n      }\n\n      reaction.track(() => {\n        _optionalChain([cancelLastGetter, 'optionalCall', _ => _()]);\n\n        let cancelled = false;\n        cancelLastGetter = () => {\n          cancelled = true;\n        };\n\n        getter(getFromAsyncValue)\n          .then(\n            action((newValue) => {\n              if (cancelled) {\n                return;\n              }\n              status = 'ready';\n              current = newValue;\n              atom.reportChanged();\n\n              return newValue;\n            }),\n          )\n          .catch((e) => {\n            if (e instanceof AsyncLoadingError) {\n              // still loading, do nothing\n              return;\n            }\n            // TODO \u5904\u7406 error \u72b6\u6001\n            throw e;\n          });\n      });\n    });\n    reaction.schedule_();\n  };\n\n  const stop = () => {\n    if (reaction) {\n      reaction.dispose();\n      reaction = null;\n    }\n  };\n\n  disposers.push(mobx.onBecomeObserved(atom, start));\n  disposers.push(mobx.onBecomeUnobserved(atom, stop));\n  disposers.push(stop);\n\n  return {\n    get status() {\n      return computedStatus.get();\n    },\n    get current() {\n      return computedCurrent.get();\n    },\n    dispose() {\n      for (const fn of disposers) {\n        fn();\n      }\n    },\n    refresh() {\n      _optionalChain([reaction, 'optionalAccess', _2 => _2.onBecomeStale_, 'call', _3 => _3()]);\n    },\n  };\n}",deps:function(){return[_,S]},provides:{mobx:s,computed:s.computed,action:s.action}};E.__inner_source=" function _optionalChain(ops) { let lastAccessLHS = undefined; let value = ops[0]; let i = 1; while (i < ops.length) { const op = ops[i]; const fn = ops[i + 1]; i += 2; if ((op === 'optionalAccess' || op === 'optionalCall') && value == null) { return undefined; } if (op === 'access' || op === 'optionalAccess') { lastAccessLHS = value; value = fn(value); } else if (op === 'call' || op === 'optionalCall') { value = fn((...args) => value.call(lastAccessLHS, ...args)); lastAccessLHS = undefined; } } return value; }function makeAsyncValue(getter, initValue) {\n  const atom = mobx.createAtom('atom@asyncSelect');\n  const disposers = [];\n\n  let status = 'loading';\n  let current = initValue;\n\n  const computedStatus = computed(() => {\n    atom.reportObserved();\n    return status;\n  });\n  const computedCurrent = computed(() => {\n    atom.reportObserved();\n    return current;\n  });\n\n  let reaction;\n  let cancelLastGetter;\n\n  const start = () => {\n    reaction = new mobx.Reaction('async', () => {\n      if (status !== 'loading') {\n        status = 'loading';\n        atom.reportChanged();\n      }\n\n      reaction.track(() => {\n        _optionalChain([cancelLastGetter, 'optionalCall', _ => _()]);\n\n        let cancelled = false;\n        cancelLastGetter = () => {\n          cancelled = true;\n        };\n\n        getter(getFromAsyncValue)\n          .then(\n            action((newValue) => {\n              if (cancelled) {\n                return;\n              }\n              status = 'ready';\n              current = newValue;\n              atom.reportChanged();\n\n              return newValue;\n            }),\n          )\n          .catch((e) => {\n            if (e instanceof AsyncLoadingError) {\n              // still loading, do nothing\n              return;\n            }\n            // TODO \u5904\u7406 error \u72b6\u6001\n            throw e;\n          });\n      });\n    });\n    reaction.schedule_();\n  };\n\n  const stop = () => {\n    if (reaction) {\n      reaction.dispose();\n      reaction = null;\n    }\n  };\n\n  disposers.push(mobx.onBecomeObserved(atom, start));\n  disposers.push(mobx.onBecomeUnobserved(atom, stop));\n  disposers.push(stop);\n\n  return {\n    get status() {\n      return computedStatus.get();\n    },\n    get current() {\n      return computedCurrent.get();\n    },\n    dispose() {\n      for (const fn of disposers) {\n        fn();\n      }\n    },\n    refresh() {\n      _optionalChain([reaction, 'optionalAccess', _2 => _2.onBecomeStale_, 'call', _3 => _3()]);\n    },\n  };\n}",E.__doc_info=x;try{y.displayName="BrowserOnlyReactJson",y.__docgenInfo={description:"",displayName:"BrowserOnlyReactJson",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../story/src/xform/helpers.tsx#BrowserOnlyReactJson"]={docgenInfo:y.__docgenInfo,name:"BrowserOnlyReactJson",path:"../story/src/xform/helpers.tsx#BrowserOnlyReactJson"})}catch(F){}try{h.displayName="ValuePreview",h.__docgenInfo={description:"",displayName:"ValuePreview",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../story/src/xform/helpers.tsx#ValuePreview"]={docgenInfo:h.__docgenInfo,name:"ValuePreview",path:"../story/src/xform/helpers.tsx#ValuePreview"})}catch(F){}try{v.displayName="ValuePrinter",v.__docgenInfo={description:"",displayName:"ValuePrinter",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["../story/src/xform/helpers.tsx#ValuePrinter"]={docgenInfo:v.__docgenInfo,name:"ValuePrinter",path:"../story/src/xform/helpers.tsx#ValuePrinter"})}catch(F){}}}]);